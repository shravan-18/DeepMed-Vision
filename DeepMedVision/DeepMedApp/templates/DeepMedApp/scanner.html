{% extends 'DeepMedApp/base.html' %}
{% load static %}

{% block title %} Medical Image Upload {% endblock %}

{% block extra_styles %}
    <style>
        /* Basic styling for the drag-and-drop area */
        #drop-zone {
            width: 100%;
            height: 150px;
            border: 2px dashed #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            cursor: pointer;
        }

        #drop-zone.dragover {
            background-color: #f0f0f0;
        }

        /* Style for the submit button */
        button[type="submit"] {
            background-color: #4CAF50; /* Green background */
            border: none;  /* Remove borders */
            color: white;  /* White text */
            padding: 10px 20px;  /* Some padding */
            text-align: center;  /* Centered text */
            text-decoration: none;  /* Remove underline */
            display: inline-block;  /* Display inline */
            font-size: 16px;  /* Set a font size */
            margin: 4px 2px;  /* Add some margin */
            cursor: pointer;  /* Pointer cursor on hover */
            border-radius: 5px;  /* Rounded corners */
            transition: background-color 0.3s ease;  /* Smooth hover effect */
        }

        button[type="submit"]:hover {
            background-color: #45a049;  /* Darker green on hover */
        }
    </style>
{% endblock %}

{% block content %}
    <h2>Medical Image Upload Form</h2>
    <form id="upload-form" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <!-- Drag and Drop Placeholder -->
        <div id="drop-zone">Drag & Drop an Image Here or Click to Select</div>
        <input type="file" id="file-input" name="image" accept="image/*" style="display:none;">
        
        <!-- Dropdown for medical image modality -->
        <label for="modality">Select Modality:</label>
        <select id="modality" name="modality">
            <option value="MRI">MRI</option>
            <option value="CT">CT</option>
        </select>
        
        <!-- Dropdown for image task -->
        <label for="task">Select Task:</label>
        <select id="task" name="task">
            <option value="chest_classification">Chest Classification</option>
            <option value="segmentation">Segmentation</option>
        </select>

        <br><br>
        <button type="submit">Submit</button>
    </form>
{% endblock %}

{% block extra_scripts %}
    <script>
        // Drag and Drop functionality
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        let file;

        dropZone.addEventListener('click', () => fileInput.click());

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            file = e.dataTransfer.files[0];
            console.log(file);
        });

        fileInput.addEventListener('change', (e) => {
            file = e.target.files[0];
            console.log(file);
        });

        // Handle form submission via AJAX
        document.getElementById('upload-form').addEventListener('submit', (e) => {
            e.preventDefault();

            const formData = new FormData();
            formData.append('image', file);
            formData.append('modality', document.getElementById('modality').value);
            formData.append('task', document.getElementById('task').value);

            fetch('/upload/', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                }
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });
    </script>
{% endblock %}
